# 批量下载功能测试指南

## 🧪 测试准备

### 环境要求
- Chrome 浏览器（最新版本）
- 已安装扩展并加载到 Chrome
- 登录抖音创作者平台账号
- 账号中有至少 2-3 个视频作品

### 加载扩展
1. 打开 `chrome://extensions/`
2. 开启"开发者模式"
3. 点击"重新加载"图标，更新扩展代码
4. 确认版本号已更新到 1.1.0

---

## 📋 测试用例

### 测试用例 1：基础下载功能
**目的**：验证批量下载按钮是否正常工作

**步骤**：
1. 访问 https://creator.douyin.com/creator-micro/content/manage
2. 确认页面顶部显示按钮组（包含"📥 批量下载"按钮）
3. 勾选 1-2 个视频
4. 点击"📥 批量下载"按钮
5. 在弹出的确认对话框中点击"确定"

**预期结果**：
- ✅ 按钮正常显示，样式为蓝色背景
- ✅ 点击后弹出确认对话框，显示下载数量
- ✅ 下载开始，浏览器下载栏显示下载进度
- ✅ 文件名为视频标题 + .mp4 扩展名
- ✅ 所有视频下载完成后弹出统计对话框

---

### 测试用例 2：批量下载多个视频
**目的**：验证批量下载队列功能

**步骤**：
1. 点击"全选"按钮，选中所有视频
2. 点击"📥 批量下载"按钮
3. 确认下载
4. 观察浏览器下载管理器

**预期结果**：
- ✅ 视频逐个下载（每个间隔 1 秒）
- ✅ 浏览器下载管理器中显示多个下载任务
- ✅ 所有下载完成后显示统计信息（成功 X 个，失败 Y 个）

---

### 测试用例 3：文件命名测试
**目的**：验证文件命名是否正确处理特殊字符

**步骤**：
1. 勾选标题中包含特殊字符的视频（如：🎉、/、:、*、?等）
2. 点击下载
3. 查看下载的文件名

**预期结果**：
- ✅ 特殊字符被替换为下划线 `_`
- ✅ 文件名不超过 100 个字符
- ✅ 文件扩展名为 .mp4

**示例**：
- 原标题：`测试视频/2024:12*14?`
- 文件名：`测试视频_2024_12_14_.mp4`

---

### 测试用例 4：空选择处理
**目的**：验证未选择视频时的提示

**步骤**：
1. 不勾选任何视频
2. 点击"📥 批量下载"按钮

**预期结果**：
- ✅ 弹出提示："请先选择要下载的视频"
- ✅ 不进行任何下载操作

---

### 测试用例 5：下载失败处理
**目的**：验证下载失败时的错误处理

**步骤**：
1. 断开网络连接（或限速）
2. 勾选视频并点击下载
3. 观察错误提示

**预期结果**：
- ✅ 下载失败的视频会被记录
- ✅ 最终统计显示失败数量
- ✅ 控制台显示详细错误信息（如果开启 DEBUG 模式）

---

### 测试用例 6：缓存数据测试
**目的**：验证下载链接是否正确缓存

**步骤**：
1. 打开浏览器开发者工具（F12）
2. 在 Console 中输入：`cachedVideoList`
3. 查看缓存数据结构

**预期结果**：
```javascript
[
  {
    aweme_id: "7441234567890123456",
    allow_download: true,
    private_status: 0,
    download_url: "https://creator.douyin.com/aweme/v1/play/?video_id=...",
    title: "视频标题"
  },
  ...
]
```

---

## 🐛 调试模式

如果遇到问题，可以开启调试模式：

1. 打开 `content_unified.js`
2. 修改第 4 行：
   ```javascript
   const DEBUG = true;  // 改为 true
   ```
3. 重新加载扩展
4. 打开开发者工具（F12）查看 Console 日志

**调试日志示例**：
```
📋 执行 getItemsVideo...
找到复选框容器: 12 个
缓存的视频列表: 12 个
📥 开始批量下载视频
下载进度: [1/5] 我的视频标题.mp4
✅ 下载成功: 我的视频标题.mp4
```

---

## ✅ 验收标准

所有测试用例通过后，确认以下功能正常：
- [x] 批量下载按钮正常显示
- [x] 下载功能正常工作
- [x] 文件命名正确（清理特殊字符）
- [x] 下载队列按顺序执行
- [x] 错误处理正常（空选择、网络错误）
- [x] 统计信息准确显示

---

## 📊 性能测试

### 推荐测试场景
- **小批量**：1-5 个视频（快速测试）
- **中批量**：10-20 个视频（常规使用）
- **大批量**：50+ 个视频（压力测试）

### 注意事项
- 大批量下载时建议分批进行（每批 20-30 个）
- 确保磁盘空间充足
- 注意网络带宽限制

---

## 🆘 常见问题

### Q1: 下载的文件没有扩展名？
**A**: 检查代码中 `filename` 是否包含 `.mp4` 扩展名

### Q2: 下载速度很慢？
**A**: 这是正常的，为避免浏览器并发限制，每个视频间隔 1 秒下载

### Q3: 部分视频下载失败？
**A**: 可能原因：
- 视频链接已过期（需要重新加载页面）
- 网络不稳定
- 视频已被删除

### Q4: 文件名显示乱码？
**A**: 确保视频标题使用 UTF-8 编码，特殊字符已被替换

---

## 📝 测试报告模板

```
测试日期：2024-12-14
测试人员：[你的名字]
扩展版本：1.1.0

测试结果：
- 测试用例 1：✅ 通过 / ❌ 失败
- 测试用例 2：✅ 通过 / ❌ 失败
- 测试用例 3：✅ 通过 / ❌ 失败
- 测试用例 4：✅ 通过 / ❌ 失败
- 测试用例 5：✅ 通过 / ❌ 失败
- 测试用例 6：✅ 通过 / ❌ 失败

发现的问题：
1. [问题描述]
2. [问题描述]

建议改进：
1. [改进建议]
2. [改进建议]
```
